<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
	

  <title>Infinite Scrollview</title>
  <meta name="description" content="You are going to do the following:">
  <meta property="og:image" content="http://www.c4ios.com/images/banner.jpg">
  <meta property="og:url"   content="http://c4ios.com" />
  <meta property="og:title" content="Infinite Scrollview"/>
  <meta name="og:description" content="You are going to do the following:">
  <meta property="og:type"  content="website"/>
  <meta property="og:site_name"  content="C4"/>

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@c4framework">
  <meta name="twitter:creator" content="@c4framework">
  <meta name="twitter:title" content="Infinite Scrollview">
  <meta name="twitter:description" content="You are going to do the following:">
  <meta name="twitter:image" content="http://www.c4ios.com/images/banner.jpg">


  <link rel="stylesheet" type="text/css" href="/css/style.css" >
  <link rel="stylesheet" href="/css/syntax.css">
  <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

  <link rel="canonical" href="www.c4ios.com/cosmos/5-Infinite-Scrollview-Build">
  <link rel="alternate" type="application/rss+xml" title="C4 website" href="www.c4ios.com/feed.xml">
</head>

    <body class="infinite-scrollview" data-spy="scroll" data-target="#toc">

    <header>
  <nav class="navbar navbar-default" role="navigation"> 
    <div class="navbar-header container">
      <div class="row"> 
        <div class="col-xs-12 col-sm-12 col-md-12 navlist">
          <a class="navbar-brand" href="/">
            <span><img src="/images/c4logo.png"></span>
          </a>
          <ul class="nav navbar-nav navbar-left">
            <li><a href="/install" >Install</a></li>
            <li><a href="/tutorials" >Tutorials</a></li>
            <li><a href="/cosmos" class='active'>COSMOS</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/examples" >Examples</a></li>
            <li><a href="http://discourse.c4ios.com">Forums</a></li>
            <li><a href="http://cocoadocs.org/docsets/C4/1.1.0/">Documentation</a></li>
          </ul>
        </div>
      </div>  
    </div>        
  </nav>      
</header>

    <div class="container content infinite-scrollview" >
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 breadcrumb">
          <h1><a href="/tutorials">Tutorials</a><div class="bread-caret">></div><a href="/cosmos">COSMOS</a><div class="bread-caret">></div>Infinite Scrollview</h1>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-3 col-sm-3 col-md-3">
          <span class="img large">
            <img src="/images/cosmos/1/poster.png" />
          </span>
          <p class="title">Chapter 5<br /><span class="lighter">Infinite Scrollview</span></p>
          <p>Tags<br /><a href="/tag/getting started">getting started</a>, <a href="/tag/basics">basics</a>, <a href="/tag/introduction">introduction</a>, <a href="/tag/easy">easy</a>, <a href="/tag/c4">c4</a>, </p>
          <p>Estimated Time<br /><span class="lighter"></span></p>

          <hr />

          <div id="toc"></div>
        </div>

        <div class="col-xs-9 col-sm-9 col-md-9 tutorial">
          <p>You are going to do the following:</p>

<ol>
  <li>Subclass UIScrollView (optional)</li>
  <li>Override the layoutSubviews() function</li>
  <li>Grab the currentOffset</li>
  <li>Skip to the end or beginning if needed</li>
</ol>

<blockquote>
  <p>Subclassing <code class="highlighter-rouge">UIScrollview</code> is optional, there already exists an <code class="highlighter-rouge">InfiniteScrollview.swift</code> file for you to fill in. If you choose to skip, you can head down to the <em>Add Some Content</em> section. However, I have included the steps to create the subclass for those of you who haven’t done this kind of thing before.</p>
</blockquote>

<h2 id="subclass-uiscrollview">Subclass UIScrollview</h2>

<p>Create a new file in Xcode by choosing:</p>

<blockquote>
  <p>Create a new file in Xcode by choosing:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>File &gt; New &gt; File…
</code></pre>
</div>

<p>or, by hitting:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CMD + N
</code></pre>
</div>

<p>Choose:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>iOS &gt; Source &gt; Swift File
</code></pre>
</div>

<p>Name the file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>InfiniteScrollView
</code></pre>
</div>

<p>When the file has been created, change the following line:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import Foundation
</code></pre>
</div>

<p>to:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import UIKit
</code></pre>
</div>

<p>Then, start typing the word <code class="highlighter-rouge">class</code> and BEFORE you finish typing you should get a popup that looks like this:</p>

<p><img src="05.png" alt="Shows the subclass option for autocompleting the word: class" /></p>

<p>Choose <strong>Swift Subclass</strong> and hit return. Xcode will fill in your new class with little spaces for you to replace.</p>

<p>Select <strong>name</strong> and type in <strong>InfiniteScrollView</strong></p>

<p>Hit <strong>Tab</strong> to move to the super class variable and type <code class="highlighter-rouge">UIScrollView</code></p>

<p>Hit <strong>Tab</strong> again to move to the properties and methods variable.</p>

<p>Start typing <code class="highlighter-rouge">layoutSubviews</code> and when autocomplete pops up, hit <strong>return</strong>.</p>

<p>Next, copy the following and paste it into the <code class="highlighter-rouge">code</code> variable within the new function you just created:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><em>Finito.</em> You’ve just created a new subclass called <code class="highlighter-rouge">InfiniteScrollView</code>. Your new class now works exactly like a <code class="highlighter-rouge">UIScrollView</code>. But, it doesn’t do anything special yet… So, let’s get to infinity.</p>

<p><em>PS your function should look like this:</em></p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span> <span class="c1">//calls the parent class method</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="putting-it-on-screen">Putting It On (Screen)</h3>

<p>It’s time to test your new class. So, navigate to your project’s <code class="highlighter-rouge">WorkSpace</code> file and fill it in like so:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kd">class</span> <span class="kt">WorkSpace</span><span class="p">:</span> <span class="kt">CanvasController</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">infiniteScrollView</span> <span class="o">=</span> <span class="kt">InfiniteScrollView</span><span class="p">()</span> <span class="c1">//create a new InfiniteScrollview object</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//creates CGRect from canvas frame</span>
        <span class="c1">//sets frame of infiniteScrollView to match canvas</span>
        <span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        
        <span class="c1">//add the view to the canvas</span>
        <span class="n">canvas</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">infiniteScrollView</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This creates a new <code class="highlighter-rouge">InfiniteScrollView</code> variable called <code class="highlighter-rouge">infiniteScrollView</code> and sets its frame to that of the current canvas, to which it’s then added.</p>

<blockquote>
  <p>You need to convert the canvas frame (a <code class="highlighter-rouge">Rect</code>) to a <code class="highlighter-rouge">CGRect</code> because <code class="highlighter-rouge">InfiniteScrollView</code> is a subclass of a <code class="highlighter-rouge">UIKit</code> object which only works with structs like <code class="highlighter-rouge">CGRect</code> and <code class="highlighter-rouge">CGPoint</code>.</p>
</blockquote>

<p>Continuing on…</p>

<p>Hit:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Build &gt; Run
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CMD+R
</code></pre>
</div>

<p>or</p>

<div class="highlighter-rouge"><pre class="highlight"><code>the play button at the top-left of the Xcode window.
</code></pre>
</div>

<p>The simulator should pop up with a seemingly blank screen… There is actually a view on there, but you can’t see it because its background is clear, and you can’t scroll it yet for reasons you’ll get into shortly.</p>

<h3 id="add-some-content">Add Some Content</h3>

<p>In order to test your new <code class="highlighter-rouge">InfiniteScrollView</code>, you need to add a few visual indicators to it.</p>

<p>Copy the following and paste it into the main body of your <code class="highlighter-rouge">WorkSpace</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre><span class="kd">func</span> <span class="nf">addVisualIndicators</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//the max number of indicators</span>
    <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="mi">20</span>
    
    <span class="c1">//the gap between indicators</span>
    <span class="k">let</span> <span class="nv">gap</span> <span class="o">=</span> <span class="mf">150.0</span>
    
    <span class="c1">//initial offset because we're positioning from the center of each indicator's view</span>
    <span class="k">let</span> <span class="nv">dx</span> <span class="o">=</span> <span class="mf">40.0</span>
    
    <span class="c1">//the calculated total width of the view's contentSize</span>
    <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">*</span> <span class="n">gap</span> <span class="o">+</span> <span class="n">dx</span>
    
    <span class="c1">//create main indicators</span>
    <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="mi">0</span><span class="o">...</span><span class="n">count</span> <span class="p">{</span>
        <span class="c1">//create a center point for the new indicator</span>
        <span class="k">let</span> <span class="nv">point</span> <span class="o">=</span> <span class="kt">Point</span><span class="p">(</span><span class="kt">Double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">gap</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c1">//create a textshape</span>
        <span class="k">let</span> <span class="nv">ts</span> <span class="o">=</span> <span class="kt">TextShape</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">x</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">point</span>
        <span class="c1">//add it to the canvas</span>
        <span class="n">infiniteScrollView</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>And, call that method in <code class="highlighter-rouge">setup()</code> like so:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">override</span> <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">infiniteScrollView</span><span class="p">)</span>
    <span class="nf">addVisualIndicators</span><span class="p">()</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>RUN</strong> it and you’ll see a bunch of numbers on screen now.</p>

<h3 id="content--scrolling">Content + Scrolling</h3>
<p>Even though there’s some stuff in <code class="highlighter-rouge">infiniteScrollView</code> you still won’t be able to scroll it because the view doesn’t implicitly know that there’s content. You have to tell it how much there is by updating its contentSize variable.</p>

<p>Add the following immediately after the for loop:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="kt">CGSizeMake</span><span class="p">(</span><span class="kt">CGFloat</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Now that the view knows its max content size, it will scroll. You use <code class="highlighter-rouge">0</code> for its content height because you don’t need it to scroll vertically.</p>

<p>If you scroll to the end you’ll notice that the last variable hangs a bit… This is because the content size was only an estimate.</p>

<p><img src="" alt="" data-id="LiveRepulsiveCarp" class="gfyitem" /></p>

<p>To fix this you could either:</p>

<ol>
  <li>Keep track of the latest origin point</li>
  <li>Figure out where the end of the frame of the last object sits</li>
</ol>

<p>Let’s update your code to do the latter.</p>

<p>Replace:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>infiniteScrollView.contentSize = CGSizeMake(CGFloat(width), 0)
</code></pre>
</div>

<p>With:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>infiniteScrollView.contentSize = CGSizeMake(CGFloat(width+gap), 0)
</code></pre>
</div>

<p>When you get to the last variable in the for loop, you calculate the center point of the last shape and add an extra gap to its x position. Now, you can see the end of the 20.</p>

<p><img src="" alt="" data-id="RawBouncyKouprey" class="gfyitem" /></p>

<p>Next, you want to start tracking the <code class="highlighter-rouge">contentOffset</code>.</p>

<blockquote>
  <p>Don’t worry that the view still bounces, you’ll get to that in a bit…</p>
</blockquote>

<h3 id="content-offset">Content Offset</h3>

<p>The way that a <code class="highlighter-rouge">UIScrollView</code> works is essentially like this: a scrollview has a ton more content than the size of its frame, at any given time the user is looking at a “content view” which is somewhere within the bounds of the scrollview’s content.</p>

<p>What you now want to find out is the location of that content view when a user is scrolling.</p>

<p>Go back to your InfiniteScrollView.swift file and update <code class="highlighter-rouge">layoutSubviews()</code> to look like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
   <span class="c1">//calls UIScrollView's layout method</span>
   <span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span>
   <span class="nf">print</span><span class="p">(</span><span class="n">contentOffset</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><code class="highlighter-rouge">UIScrollview</code> has a <code class="highlighter-rouge">contentOffset</code> property, so what you’ve just done is told your app to print that variable’s <code class="highlighter-rouge">x</code> coordinate to the console whenever <code class="highlighter-rouge">layoutSubviews()</code> gets called.</p>

<p><strong>RUN</strong> the app and when you scroll it in the simulator you’ll see a bunch of numbers pop up in Xcode’s console.</p>

<p>If you can’t see Xcode’s console, then just hit <strong>CMD+SHIFT+C</strong></p>

<p>Or, tap the icon in the top-right of the Xcode window, like this:</p>

<p><img src="" alt="" data-id="BarrenHastyIrukandjijellyfish" class="gfyitem" /></p>

<p>You are now tracking the <code class="highlighter-rouge">x</code> position of your scrollview’s <code class="highlighter-rouge">contentOffset</code>.</p>

<blockquote>
  <p>You may have noticed that when you bounce towards the beginning of the content the value of contentOffset.x goes negative… You’re going to use this to your advantage.</p>
</blockquote>

<h3 id="infinite-rules">Infinite Rules</h3>

<p>You now want to apply the rules (above) to your view so that it scrolls infinitely.</p>

<p>Update your <code class="highlighter-rouge">layoutSubviews()</code> function to look like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kd">public</span> <span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span>

    <span class="c1">//grab the current content offset (top-left corner)</span>
    <span class="k">var</span> <span class="nv">curr</span> <span class="o">=</span> <span class="n">contentOffset</span>
    <span class="c1">//if the x value is less than zero</span>
    <span class="k">if</span> <span class="n">curr</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="c1">//update x to the end of the scrollview</span>
        <span class="n">curr</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">contentSize</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">frame</span><span class="o">.</span><span class="n">width</span>
        <span class="c1">//set the content offset for the view</span>
        <span class="n">contentOffset</span> <span class="o">=</span> <span class="n">curr</span>
    <span class="p">}</span>
        <span class="c1">//if the x value is greater than the width - frame width</span>
        <span class="c1">//(i.e. when the top-right point goes beyond contentSize.width)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">curr</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">contentSize</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">frame</span><span class="o">.</span><span class="n">width</span> <span class="p">{</span>
        <span class="c1">//update x to the beginning of the scrollview</span>
        <span class="n">curr</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">//set the content offset for the view</span>
        <span class="n">contentOffset</span> <span class="o">=</span> <span class="n">curr</span>
    <span class="p">}</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Whenever you go past the edges of your content, in either direction, the view should immediately skip so that it can continue scrolling.</p>

<p><strong>RUN</strong> it and try it out for yourself.</p>

<h3 id="overlap-snap">Overlap Snap</h3>

<p>One thing you should have noticed is that when the view overlaps (i.e. goes from beginning to end, or vice versa), its content makes a very awkward jump…</p>

<p><img src="" alt="" data-id="CandidAntiqueBronco" class="gfyitem" /></p>

<p>The solution to this is to attach a copy of the first content view’s contents to the end of your scrollview so that when it snaps it looks seamless.</p>

<p><img src="06.png" alt="You'll add a copy of the first frame to the end of your content view." /></p>

<p>However, this has absolutely NOTHING to do with the scrollview itself. This trick relies entirely on how you add content to your scrollview.</p>

<p>So, head back over to your <code class="highlighter-rouge">WorkSpace</code>.</p>

<h2 id="proper-setup">Proper Setup</h2>

<p>Add a new method called <code class="highlighter-rouge">createIndicator()</code> that you’ll use to create and add text shapes to your scrollview.</p>

<p>Add the following to your <code class="highlighter-rouge">WorkSpace</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="kd">func</span> <span class="nf">createIndicator</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">at</span> <span class="nv">point</span><span class="p">:</span> <span class="kt">Point</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//create a textshape</span>
    <span class="k">let</span> <span class="nv">ts</span> <span class="o">=</span> <span class="kt">TextShape</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="n">text</span><span class="p">)</span>
    <span class="c1">//center the shape</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">point</span>
    <span class="c1">//add it to the canvas</span>
    <span class="n">infiniteScrollView</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This method takes a <code class="highlighter-rouge">String</code> and a <code class="highlighter-rouge">Point</code>, creates a new text shape indicator, positions it and adds it to the scrollview.</p>

<p>Simple.</p>

<p>Now, replace the contents of <code class="highlighter-rouge">addVisualIndicators</code> with the following:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><pre><span class="kd">func</span> <span class="nf">addVisualIndicators</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//the max number of indicators</span>
    <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="mi">20</span>
    
    <span class="c1">//the gap between indicators</span>
    <span class="k">let</span> <span class="nv">gap</span> <span class="o">=</span> <span class="mf">150.0</span>
    
    <span class="c1">//initial offset because we're positioning from the center of each indicator's view</span>
    <span class="k">let</span> <span class="nv">dx</span> <span class="o">=</span> <span class="mf">40.0</span>
    
    <span class="c1">//the calculated total width of the view's contentSize</span>
    <span class="k">let</span> <span class="nv">width</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gap</span> <span class="o">+</span> <span class="n">dx</span>
    
    <span class="c1">//create main indicators</span>
    <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="mi">0</span><span class="o">...</span><span class="n">count</span> <span class="p">{</span>
        <span class="c1">//create a center point for the new indicator</span>
        <span class="k">let</span> <span class="nv">point</span> <span class="o">=</span> <span class="kt">Point</span><span class="p">(</span><span class="kt">Double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">gap</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c1">//create a new indicator</span>
        <span class="nf">createIndicator</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">x</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">//create additional indicators</span>
    <span class="k">var</span> <span class="nv">x</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1">//create an offset variable</span>
    <span class="k">var</span> <span class="nv">offset</span> <span class="o">=</span> <span class="n">dx</span>
    
    <span class="c1">//The total width (including the last "view" of the infiniteScrollView is based on the width + screen width</span>
    <span class="c1">//So, the total width and count of how many "extra" indicators to add is somewhat arbitrary</span>
    <span class="c1">//This is why we use a while loop</span>
    
    <span class="c1">//while the offset is less than the view's width</span>
    <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="kt">Double</span><span class="p">(</span><span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//create a center point whose x value starts is the total width + the current offset</span>
        <span class="k">let</span> <span class="nv">point</span> <span class="o">=</span> <span class="kt">Point</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c1">//create the width</span>
        <span class="nf">createIndicator</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">x</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span>
        <span class="c1">//increase the offset for the next point</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">gap</span>
        <span class="c1">//increate x to be used as the variable for the next indicator's number</span>
        <span class="n">x</span><span class="o">++</span>
    <span class="p">}</span>
    
    <span class="c1">//update infiniteScrollView contentSize</span>
    <span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="kt">CGSizeMake</span><span class="p">(</span><span class="kt">CGFloat</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">infiniteScrollView</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Now, everything is nice and smooth.</p>

<p><img src="" alt="" data-id="SelfreliantCoolHake" class="gfyitem" /></p>

<p>The view now smoothly loops when you go past the end or the beginning.</p>

<h2 id="wrapping-up">Wrapping Up.</h2>

<p>You’ve added infinite scrolling to UIKit’s <code class="highlighter-rouge">UIScrollView</code> class, which was the easy part. The magic in getting the effect of infinite scrolling actually depends on how you create and add content to the view itself.</p>

<p>You’ve also learned how to add an extra bit of content on to the end of your view so that the effect is seamless when the view snaps into position as it scrolls in any direction.</p>

<p>Getting the extra content positioned properly is usually where the most of your work will take place in setting up an infinite scrollview. Like in this example, if you’re laying out code programmatically, you’ll probably have to make a bunch of tweaks until everything is in the right place.</p>

<h3 id="code">Code</h3>

<p>Here’s a final copy of the <code class="highlighter-rouge">InfiniteScrollview</code> class:</p>

<p><a href="https://gist.github.com/C4Framework/60f9f8ec1824ce8a2807">InfiniteScrollview Code</a></p>

        </div>
      </div>
    </div>

    <div class="container">
      <div class="row chapter-nav">
        <div class="col-xs-12 col-sm-12 col-md-12">
          <h1 class="text-center blue">Well done! Continue COSMOS?</h1>
          <ul class="examples-list next-prev list-unstyled">
            
              <li class="pull-left">
                <a class="more" href="/cosmos/4-Infinite-Scrollview" title="Earlier article: Infinite Scrollview">
                  <div>
                    <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
                    <span class="img">
                      <img src="/images/cosmos/4/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 4<br />Infinite Scrollview</p>
                      <p>Implementing the idea of an infinite scrollview that loops around rather than stopping at the end.</p>
                    </div>
                  </div>
                </a>
              </li>
            
            
              <li class="pull-right">
                <a class="more" href="/cosmos/6-Astrological-Sign-Provider" title="Later article: Astrological Sign Provider">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/6/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 6<br />Astrological Sign Provider</p>
                      <p>How to go about wrangling all the data for the 12 astrological signs.</p>
                    </div>
                    <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
                  </div>
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row related">
        <div class="col-xs-12 col-md-12">
          <h1 class="text-center blue">All COSMOS Chapters</h1>
          <ul class="examples-list list-unstyled">
            
            
              <li>
                <a href="/cosmos/0-getting-started">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/0/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 0<br />Getting Started</p>
                      <p>Get up and running quickly with the COSMOS Xcode project files.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/1-prelude-to-design">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/1/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 1<br />Prelude To Design</p>
                      <p>An overview explaining why & how we chose to create COSMOS in the first place.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/2-designing-the-cosmos">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/2/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 2<br />Designing the COSMOS</p>
                      <p>Where to start? Defining the visual concept and deciding the functionality.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/3-plan-it">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/3/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 3<br />Plan It!</p>
                      <p>Get your goggles on as we start diving into the code with C4.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/4-Infinite-Scrollview">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/4/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 4<br />Infinite Scrollview</p>
                      <p>Implementing the idea of an infinite scrollview that loops around rather than stopping at the end.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/5-Infinite-Scrollview-Build">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/5/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 5<br />Infinite Scrollview</p>
                      <p>Time to code – get that infinite scrollview looping.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/6-Astrological-Sign-Provider">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/6/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 6<br />Astrological Sign Provider</p>
                      <p>How to go about wrangling all the data for the 12 astrological signs.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/7-Astrological-Sign-Provider-Build">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/7/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 7<br />Astrological Sign Provider - Build it!</p>
                      <p>We've wrangled all that data, now let's do something with it.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/8-Stars">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/8/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 8<br />Stars</p>
                      <p>Start bringing the COSMOS to life with some nice visual work.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/9-Parallax-Testing">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/9/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 9<br />Parallax Testing (Optional)</p>
                      <p>This optional chapter will walk you through how I originally tested the background.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/10-Stars-Background">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/10/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 10<br />Stars Background</p>
                      <p>Time to stargaze – we're going to build some constellations.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/11-Sign-Lines">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/11/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 11<br />Sign Lines</p>
                      <p>Time to stargaze – we're going to build some constellations.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/12-Small-Stars">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/12/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 12<br />Small Stars</p>
                      <p>Bring those constellations to life with stars. We're starting small.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/13-Big-Stars">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/13/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 13<br />Big Stars</p>
                      <p>We've got the small constellation stars, let's keep going with the big ones.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/14-Assembling-The-Stars">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/14/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 14<br />Assembling the Stars</p>
                      <p>Small stars, meet big stars. Time to unite them all.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/15-Radial-Menu">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/15/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 15<br />Radial Menu</p>
                      <p>Building the heart of the app - a radial menu with embedded animation that reacts to different gestures.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/16-Menu-Rings">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/16/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 16<br />Menu Rings</p>
                      <p>It's time to build the backbone of our radial menu.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/17-Menu-Rings">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/17/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 17<br />Animating the Menu Rings</p>
                      <p>Time to bring the radial menu to life with embedded animation.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/18-Menu-Icons">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/18/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 18<br />Menu Icons</p>
                      <p>Time to flesh out the radial menu with some animated icons.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/19-Menu-Selector">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/19/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 19<br />Menu Selector</p>
                      <p>Give the radial menu interaction and responsiveness with some programming wizardry.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/20-Menu-Shadow">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/20/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 20<br />Menu Shadow</p>
                      <p>Give a little visual pop to the radial menu with a simple shadow.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/21-Menu-Pull-It-Together">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/21/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 21<br />The Menu – Pull it Together</p>
                      <p>We've got all the components, let's get this beast put together now.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/22-Info-Panel">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/22/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 22<br />Info Panel</p>
                      <p>A straightforward info panel with push controllers, popups and external links.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/23-Pulling-It-All-Together">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/23/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 23<br />Pulling It All Together</p>
                      <p>Time to weave all the components into a unified app.</p>
                    </div>
                  </div>
                </a>
              </li>
            
              <li>
                <a href="/cosmos/24-Pulling-It-All-Together">
                  <div>
                    <span class="img">
                      <img src="/images/cosmos/24/poster.png" />
                    </span>
                    <div class="text">
                      <p class="title">Chapter 24<br />Submitting to App Store</p>
                      <p>Our last task is to get COSMOS on the App Store. Seriously.</p>
                    </div>
                  </div>
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-3 col-sm-3 col-xs-6">
        <ul class="list-unstyled">
          <li class="title"><a href="/#overview">About</a></li>
          <li><a href="/#overview">Features</a></li>
          <!-- <li><a href="/about#history">History</a></li> -->
          <!-- <li><a href="/about/contributors">Contributors</a></li> -->
        </ul>
      </div>
      <div class="col-md-3 col-sm-3 col-xs-6">
        <ul class="list-unstyled">
          <li class="title"><a href="/learn">Learn + Explore</a></li>
          <li><a href="/install">Install C4</a></li>
          <li><a href="/examples">Examples</a></li>
          <li><a href="/tutorials">Tutorials</a></li>
          <li><a href="http://cocoadocs.org/docsets/C4/1.1.0/">Docs</a></li>
        </ul>
      </div>
      <div class="col-md-3 col-sm-3 col-xs-6">
        <ul class="list-unstyled">
          <li class="title"><a href="/contact">Connect</a></li>
          <li><a href="http://discourse.c4ios.com">Forums</a></li>
          <li><a href="http://www.medium.com/@c4framework" target="_blank">Medium</a></li>
          <li><a href="http://www.twitter.com/c4framework" target="_blank">Twitter</a></li>
          <li><a href="https://join-c4.herokuapp.com/" target="_blank">Slack</a></li>
          <li><a href="https://vimeo.com/c4ios" target="_blank">Vimeo</a></li>
          <li><a href="http://github.com/c4framework" target="_blank">GitHub</a></li>
        </ul>
      </div>
      <div class="col-md-3 col-sm-3 col-xs-6">
        <ul class="list-unstyled">
          <!-- <li class="title"><a href="/about">Sign Up for Newsletter</a></li>
          <li><input type="text" placeholder="Enter Email + Press Enter"></li> -->
          <li>© 2016 C4</li>
          <li><a href="/terms">Terms of Use</a></li>
          <li><a href="mailto:info@c4ios.com">Contact</a></li>
        </ul>    
      </div>
    </div>
  </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-18444113-4', 'auto');
  ga('send', 'pageview');
</script>


    <script type="text/javascript" src="/js/toc.js"></script>
    <script>
     (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = 'http://assets.gfycat.com/js/gfyajax-0.517d.js';
        s.parentNode.insertBefore(g, s);
      }(document, 'script'));
    </script>
    <script type="text/javascript">
      $(document).ready(function() {
        $('#toc').width($('#toc').parents().width());

        $('#toc').toc({
          elementClass: 'toc',
          ulClass: 'nav',
          heading: 'Contents',
          indexingFormats: 'number',
          selector: 'h2, h3, h4',
        });

        $('body').scrollspy({
          target: '#toc',
          offset: $('#headerNav').outerHeight(true)
        });

        setTimeout(function() {
          var $sideBar = $('#toc');
          $sideBar.affix({
            offset: {
              top: function() {
                var offsetTop      = $sideBar.offset().top,
                sideBarMargin  = parseInt($sideBar.children(0).css('margin-top'), 10),
                navOuterHeight = $('#headerNav').height();
                return (this.top = offsetTop - navOuterHeight - sideBarMargin);
              },
              bottom: function() {
                return (this.bottom = $('footer').outerHeight(true) + $('.chapter-nav').outerHeight(true) + $('.related').outerHeight(true) + 60);
              }
            }
          });
        }, 100);

        $('td.gutter').each(function(index)
        {
          $(this).parents('.language-swift').closest('pre').addClass('has-gutter');
        });

        $('.tutorial img').each(function()
        {
          console.log($(this).parent());
          var img = $(this).attr('src');
          $(this).attr('src', '/images/cosmos/5/' + img + '').addClass('img-responsive');
        });

        $('.tutorial p img').unwrap().wrap('<figure></figure>').after(function() {
            return '<figcaption>'+this.alt+'</figcaption>';
        });

        $('.footnotes').prepend('<h4>Footnotes</h4>');
      });
    </script>
  </body>
</html>